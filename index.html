<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    html,body{margin:0;height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell}

    .notice{
      position:sticky; top:0; z-index:999;
      padding:10px 16px; text-align:center;
      background:#fffbe6; border-bottom:1px solid #f0e6b7;
      font:500 14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell;
    }

    model-viewer{
      width:100%; height:90vh; background:#f5f5f7;
      --progress-bar-height: 4px;
      --progress-bar-color: rgba(0,0,0,.85);
    }
    model-viewer::part(progress-bar){
      position:absolute; top:8px; bottom:auto; left:50%;
      transform:translateX(-50%); width:60%;
    }
    /* Hide the built-in AR button so users don't launch Scene Viewer without our params */
    model-viewer::part(ar-button){ display:none; }

    .links{
      display:flex; gap:16px; padding:12px 16px; flex-wrap:wrap;
    }
    .links a{
      display:inline-block; padding:10px 14px; border-radius:12px; background:#fff;
      border:1px solid #ddd; text-decoration:none; color:#111; font-weight:600;
      box-shadow:0 2px 12px rgba(0,0,0,.06);
    }
  </style>
</head>
<body>
  <div class="notice">
    Note: This page works properly only on <strong>mobile devices</strong> using <strong>Chrome (Android)</strong> or <strong>Safari (iOS)</strong>.
  </div>

  <div class="links">
    <a id="ar-android" href="#">Open on Android</a>
    <a id="ar-ios" rel="ar" href="#">Open on iOS</a>
  </div>

  <model-viewer
    id="mv"
    src="model.glb"
    ios-src="model.usdz"
    camera-controls
    shadow-intensity="1"
    <!-- Force WebXR (no Scene Viewer) if the user taps any custom AR you might add later -->
    ar
    ar-modes="webxr quick-look">
  </model-viewer>

  <script>
    (function () {
      const glbUrl  = new URL('model.glb',  location.href).toString();
      const usdzUrl = new URL('model.usdz', location.href).toString();

      const mv = document.getElementById('mv');
      mv.src = glbUrl;
      mv.setAttribute('ios-src', usdzUrl);

      // Fallback HTTP URL (rarely used, but keep it consistent)
      const sceneViewerHttp =
        `https://arvr.google.com/scene-viewer/1.0?file=${encodeURIComponent(glbUrl)}` +
        `&mode=ar_preferred&disable_occlusion=true&title=${encodeURIComponent('Model')}`;

      // Explicit intent to ARCore package WITH occlusion disabled
      // (documented by Google: disable_occlusion=true)
      const intentUrl =
        `intent://arvr.google.com/scene-viewer/1.0?file=${encodeURIComponent(glbUrl)}` +
        `&mode=ar_only&disable_occlusion=true&title=${encodeURIComponent('Model')}` +
        `#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;` +
        `S.browser_fallback_url=${encodeURIComponent(sceneViewerHttp)};end;`;

      const aAndroid = document.getElementById('ar-android');
      const aIos     = document.getElementById('ar-ios');
      const isAndroid = /Android/i.test(navigator.userAgent);

      aAndroid.href = isAndroid ? intentUrl : sceneViewerHttp;
      aIos.href = usdzUrl;
    })();
  </script>
</body>
</html>
