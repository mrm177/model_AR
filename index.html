<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    html,body{margin:0;height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell}

    model-viewer{
      width:100%; height:90vh; background:#f5f5f7;
      /* progress bar appearance */
      --progress-bar-height: 4px;
      --progress-bar-color: rgba(0,0,0,.85);
    }
    /* Move the progress bar to the top-center */
    model-viewer::part(progress-bar){
      position:absolute; top:8px; bottom:auto; left:50%;
      transform:translateX(-50%); width:60%;
      z-index: 2;
    }
    /* Built-in AR button moved to the top-right */
    model-viewer::part(ar-button){
      position:absolute;
      top: calc(12px + env(safe-area-inset-top));
      right: 16px;
      bottom:auto; left:auto;
      padding:10px 14px;
      border-radius:12px;
      background:#fff;
      border:1px solid #ddd;
      font:600 14px/1 system-ui;
      box-shadow:0 2px 12px rgba(0,0,0,.12);
      z-index: 3;
    }

    .links{
      display:flex; gap:16px; padding:12px 16px; flex-wrap:wrap;
    }
    .links a{
      display:inline-block; padding:10px 14px; border-radius:12px; background:#fff;
      border:1px solid #ddd; text-decoration:none; color:#111; font-weight:600;
      box-shadow:0 2px 12px rgba(0,0,0,.06);
    }
  </style>
</head>
<body>
  <!-- Optional hard AR links -->
  <div class="links">
    <a id="ar-android" href="#" style="display:none">Open in AR (Android)</a>
    <a id="ar-ios" rel="ar" href="#" style="display:none">Open in AR (iOS)</a>
  </div>

  <model-viewer
    id="mv"
    src="model.glb"
    ios-src="model.usdz"
    ar
    ar-modes="scene-viewer webxr quick-look"
    camera-controls
    shadow-intensity="1">
  </model-viewer>

  <script>
    (function () {
      // Build absolute URLs so Scene Viewer / Quick Look can fetch the files
      const glbUrl  = new URL('model.glb',  location.href).toString();
      const usdzUrl = new URL('model.usdz', location.href).toString();

      // Update model-viewer sources to absolute URLs
      const mv = document.getElementById('mv');
      mv.src = glbUrl;
      mv.setAttribute('ios-src', usdzUrl);

      // --- Platform detect (Android / iOS / other) ---
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      const isAndroid = /Android/i.test(ua);
      const isIOS = /iPhone|iPad|iPod/i.test(ua) ||
                    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

      // Scene Viewer URL (HTTP fallback) and Intent (preferred on Android)
      const sceneViewerHttp =
        `https://arvr.google.com/scene-viewer/1.0?file=${encodeURIComponent(glbUrl)}&mode=ar_preferred&title=${encodeURIComponent('Model')}`;

      const sceneViewerIntent =
        `intent://arvr.google.com/scene-viewer/1.0?file=${encodeURIComponent(glbUrl)}&mode=ar_preferred&title=${encodeURIComponent('Model')}` +
        `#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;` +
        `S.browser_fallback_url=${encodeURIComponent(sceneViewerHttp)};end;`;

      // Wire optional buttons
      const btnAndroid = document.getElementById('ar-android');
      const btnIOS = document.getElementById('ar-ios');

      if (isAndroid) {
        if (btnAndroid) { btnAndroid.href = sceneViewerIntent; btnAndroid.style.display = ''; }
      } else if (isIOS) {
        if (btnIOS) { btnIOS.href = usdzUrl; btnIOS.rel = 'ar'; btnIOS.style.display = ''; }
      } else {
        // Desktop/other: show both as generic links
        if (btnAndroid) { btnAndroid.href = sceneViewerHttp; btnAndroid.style.display = ''; }
        if (btnIOS)     { btnIOS.href = usdzUrl;           btnIOS.style.display = ''; }
      }
    })();
  </script>
</body>
</html>
